language: r
sudo: false
dist: trusty
cache: packages

env:
  global:
    - _R_CHECK_TIMINGS_=0
    - _R_CHECK_FORCE_SUGGESTS_=0  # no error if suggested packs are not avail
    - _R_CHECK_TESTS_NLINES_=999
    - secure: "d0xff7hriQyReF4y3/iR5sHJlXocKNKcN6/Gi/r9Hxsfuh2Hx3fouQCMSPP+Oba6MDgEvAfryToAxcmaoZByQMwgevB0OBy5xkatj3oTHmhN5Nbk3jNXxXfA6P0Oqxaf7lXVZk2+Ly+PWnbgXn0uhjzdaZo0cWtVJ660ajS0x9Q="

addons:
  apt:
    packages:
      - libgmp-dev
      - libgsl0-dev
      - pandoc

warnings_are_errors: true

jobs:
  include:
    - stage: packages
      install:
        - pip install --user mkdocs
        - pip install --user python-markdown-math
        - Rscript r_packs_install.R
      script: true
    - stage: build
      install: 
        - ./build
      script: true

after_success:
    - git checkout gh-pages
    - git config user.name $GIT_NAME
    - git config user.email $GIT_EMAIL
    - git config credential.helper "store --file=.git/credentials"
    - echo "https://$GH_TOKEN:@github.com" >> .git/credentials
    - git config push.default matching
    - git add devel
    - git commit -a -m "update auto-generated tutorial pages [ci skip]"
    - git push

notifications:
  email:
    recipients:
        - bernd_bischl@gmx.net
        - larsko@cs.ubc.ca
        - schiffner@math.uni-duesseldorf.de
    on_success: change
    on_failure: always
  slack: mlr-org:jiHX1LxqUBJUCJmCioo7vUVl#buildnotifications
